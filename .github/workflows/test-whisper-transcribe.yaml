name: Whisper MP4 Transcription Test

# Create a GitHub Actions workflow to test the Whisper MP4 transcription script with a real MP4 file
# Generated by DevOpsZealot AI
# Branch: feature/nuvo1

on:
  push:
    branches: [feature/nuvo1]
    paths:
      - 'whisper_mp4_transcript.sh'
  pull_request:
    branches: [main, master]
  workflow_dispatch:
    inputs:
      debug:
        description: 'Enable debug logging'
        required: false
        default: false
        type: boolean

jobs:
  test-transcription:
    runs-on: ubuntu-latest
    name: Test Whisper MP4 Transcription
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install FFmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
      
      - name: Install Whisper dependencies
        run: |
          pip install torch openai-whisper
      
      - name: Create output directory
        run: mkdir -p test-output
      
      - name: Make script executable
        run: chmod +x whisper_mp4_transcript.sh
      
      - name: Run transcription
        run: ./whisper_mp4_transcript.sh input/test-meeting.mp4 test-output tiny
      
      - name: Verify transcript was generated
        run: |
          if [ ! -f "test-output/test-meeting.txt" ]; then
            echo "Error: Transcript was not generated"
            exit 1
          fi
          echo "Transcript generated successfully"
          cat test-output/test-meeting.txt
      
      - name: Upload transcript artifact
        uses: actions/upload-artifact@v4
        with:
          name: whisper-transcript
          path: test-output/test-meeting.txt
